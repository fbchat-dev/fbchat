sudo: false
language: python
python:
- 2.7
- 3.4
- 3.5
- 3.6

env:
  global:
    # These two accounts are made specifically for this purpose, and the passwords are really only encrypted for obscurity
    # In reality, you could probably still login with the accounts by looking at log output from travis-ci.org
    - client1_email=travis.fbchat1@gmail.com # Facebook ID: 100023782141139
    - secure: "m8KWZixMEo8mPOb2Pb+q97S4Dt9+2aSwYzaAOHc97uO3Y1c0AFxUEkDhk5FPz8AGSLEDKEm/IeTSre3jwVY+VyziZmRQymVgLWONoZlhixODR3yH+8VG+Z6HqsAFFjWOnJ1yFDmnuRROFO+SSIgIfR42LHcV6JY0W9Qq9cR1ATj0Nqy2DtLEZXWP16NyM8YiGhzUMPIhC4/Ky+D8emR+UrVrQMkF0TMl8FdGv782Py/7/DhoPlgJtdYB5vqUuYjVUAVAWK+Yc57vjaMFnHMekAwELpI3v7kcohMkjqKSglMEGOTQkHwe65aDSvzjtGoQZkavGSX4sdnfh4tFY29JOQQUri29fhIxOC1aCxrwx90Q/VuJKnf2/yR5mL5v70B3aChdWb+NGpznp6QsEd906KIpEvZ3+YA0Lif8ztXm9iJ7cGJqyWtghTQrcbaRk1kZRLky+0+Ar1wFMjqs8KjQZ2skdPUAOSMPWT1g0rSk69klw4CX5vjsIOF90NI5+oJqWTnB2dFuQTvmle12W3jUkkAMjG0fwYsHOBH5xRj+Y1V9a1K2g4d99EoGhJvrSo6Rlg1WnJyj0KqhTpeTk83PXcYL80hhG63ELPfkBz1MDGnURyaF8oQDdTJXUglYGcKOznz6V78LTi6zBieSM9AUnw9yZnvLfO8539NNQ5HZNPE=" # client1_password
    - client2_email=fbchat.travis2@gmail.com # Facebook ID: 100026538491708
    - secure: "N3D/JixDBtue+aqF65eWZiop0MdK7ruQskhH6rRa08Ih7BUGI4D3LNmsVr1dUqxyjFwFgQAyd5NeKeU2dAaIpxE8EUpz54EpopSfsIyTOr1o4mt1J1qzNQEuDq0Tq2JIENI/n7HM4nemEmUI98YgiMvkd7hP7CMCn62sguJmJ0Zu4JJKS9fXpLYcTa07Z9zwv/OSCDC7x4IaKcQ8GKmV98IWcSCcfUqn7x55oCzn9xcJ5QCVal7vuo9jE6nLOCWr9hKLZsu0QtY7KJshURNAMFxuDFaVNXqcq7cyApIUgjWONT7+eg8H//qo0DVBter7gR0l7SDZX+DjrFzk+NLwxgOcfDlpr3TMrBFUYLFYDbVZMR8NqdlotKzZ8YgchqRL66XxpJ1x24Q+wbxE7vUTF9emqfo6JM1SDQREbdANYgB+tXSLVrJCKxZaxxdVp0tOJD6ukUHlpDoSR1owdKFUJkEYA9OqzlT3NZKDzlEXZ66RRE8eBfdYuJUtsAJWiGd62HRSekdLhRAkXs+KOs7IC9uAEiL6SjGVltISTxaABB9odhXeggP4+LIzZccMfokgafDSjbQb4FmIGrQV1C+AcG5l10crCTH340oXeGVt+uzULtLfgIpS2em92y1vWqqO/NGN0a8aBJDd3hUx3mY+zGhHj7iLYWgAzOw2fpLVtfk=" # client2_password
    - group_id=1463789480385605

before_script:
  - if [[ "$TRAVIS_PYTHON_VERSION" = "2.7" ]]; then export PYTEST_ADDOPTS='-m ""'; fi; # expensive tests (otherwise disabled in pytest.ini)
  - if [[ "$TRAVIS_PULL_REQUEST" != false ]]; then export PYTEST_ADDOPTS='-m offline'; fi; # offline tests only

script: python -m pytest || python -m pytest --lf; # Run failed tests twice

cache: pip

deploy:
  provider: pypi
  user: madsmtm
  password:
    secure: "DogYIZ6eZZUUwkuhnhxGZ1SR/NrNvQtadxk06oeNfIeZL1UdIkSAS+C+BD1xr4iu3JwSZKDgU43I/aj8TomG69HVxQ9lcEmteUOfMKIOrDtGluNOG+a7KnVltEygc7m55wdQcPdwy2d906fWlvPz9u2ko2S3CH8FDxzW7sj79WwFEPLd/JYk1Jgs6GeJ14XLHEGDIaGUkXKroVBx0JqBzyYCuHgY8iLT1Hzln04DQSuUGAoel6oYeznxJ2VHmUvjD9vCis6ydoi4LUJG16ebe/f4ifl1sjGOcd1YBf/JoMIP0C7ntyBJ0B23e98o/8ORYyCKIHVRTxN0q5lF/s/Oj/vfTAoM5w3sEi0kS3yLuug/jIW961iaz+Vrm1TDJdbCloeZyo3GvEqMO062i5EadaudAOfxreg+secYB8Ckc/x9NtXhc3YmG6YBk6qtZeJBSnF5/YqHPydYAndJ6o/3VjuJHrTLzFoukw8swmls5kTgvyDJFEodGLhnb5nZo7/5ZkwiqNgyYKqFnKvQDTJ2le/Gc3U1SO+V4pXv/7mrtB7gMogPOZtMinCPmDvRvXFj5QPRyyQVIGVESd8LthRw24YI54TJW9srvoYGN5Axjrrlt4Y+j/GWeWyHckkhsLDB5JBw5kHkP8M1Q2d05+1ZaA1aT0JSVE+DMn/IWNILRvI="
  on:
    branch: master
    tags: true
  server: https://test.pypi.org/legacy/
